#!/usr/bin/env bash

set -xe

PREFIX="${PREFIX:-${HOME}/.local}"
BIN_INSTALL_DIR="${PREFIX}/bin"
BIN_INSTALL_FILE="${BIN_INSTALL_DIR}/claude-sandbox"

mkdir -p "${BIN_INSTALL_DIR}"

# append noread.sb as a variable NOREAD_SB_CONTENT
cat > "${BIN_INSTALL_FILE}" <<'EOF'
#!/usr/bin/env bash

# Embedded noread.sb
read -r -d '' NOREAD_SB_CONTENT <<'INNER_EOF'
EOF
cat noread.sb >> "${BIN_INSTALL_FILE}"
echo "INNER_EOF" >> "${BIN_INSTALL_FILE}"

# append claude-sandbox script without the hashbang
tail -n +2 claude-sandbox >> "${BIN_INSTALL_FILE}"

chmod +x "${BIN_INSTALL_FILE}"
